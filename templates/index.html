<!DOCTYPE HTML>
<html lang = 'zh-TW'>
    <head>
        <meta charset = 'UTF-8'>
        <title>è‚¡åƒ¹æŸ¥è©¢</title>
        <style>
            body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background-color: #f9f9f9;
            }

            h2 {
            color: #333;
            }

            input, button {
            padding: 8px 12px;
            font-size: 16px;
            margin-right: 8px;
            }

            button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            }

            button:hover {
            background-color: #45a049;
            }

            #result {
            background-color: #fff;
            padding: 16px;
            margin-top: 20px;
            border: 1px solid #ddd;
            white-space: pre-wrap;
            }

            .error {
            color: red;
            font-weight: bold;
            }
        </style>
    </head>
    <body>
        <h2>è«‹è¼¸å…¥è‚¡ç¥¨ä»£è™ŸåŠç›®æ¨™è‚¡åƒ¹æŸ¥è©¢è‚¡ç¥¨è³‡è¨Š  ( ä¾‹ï¼š2330:990 )</h2>
        <input type="text" id = 'MultiInput' placeholder="è«‹è¼¸å…¥è‚¡ç¥¨ä»£è™ŸåŠç›®æ¨™è‚¡åƒ¹">
        <button onclick="Multisearch()">æŸ¥è©¢</button>

        <div id = 'result'></div>

        <script>
            async function Multisearch() {
                const row = document.getElementById('MultiInput').value.trim();
                const resultDiv = document.getElementById('result');
                
                if(!row){
                    resultDiv.innerHTML = '<span class = "error">è«‹è¼¸å…¥è‚¡ç¥¨ä»£è™ŸåŠç›®æ¨™è‚¡åƒ¹</span>';
                    return;
                }

                resultDiv.innerHTML = 'æŸ¥è©¢ä¸­...';


                const data = await row.split(',').map(item => {
                    const[code,price] = item.trim().split(':');
                    return {stock_code:code.trim(), target:parseFloat(price.trim())}
                });
                const response = await fetch('/multi_check',{
                    method:"POST",
                    headers:{'Content-Type':'application/json'},
                    body:JSON.stringify(data)
                });
                
                const result = await response.json();

                if(Array.isArray(result)){
                    let html = ''
                    result.forEach(stock => {
                        if(stock.status === 'Success'){
                            html+=`
                            <div>
                                ğŸ“ˆè‚¡ç¥¨åç¨±ï¼š${stock.stock_name} ( ${stock.stock_num} )<br>
                                ğŸ’µç•¶å‰è‚¡åƒ¹ï¼š${stock.stock_price} å…ƒ${stock.currency}<br>
                                ğŸ•˜æ“·å–æ™‚é–“ï¼š${stock.time}
                            </div>
                            `;
                        }else{
                            html+=`
                            <div class='error'>âŒæŸ¥ç„¡è‚¡ç¥¨ä»£è™Ÿ${stock.stock_num}</div>
                            `;
                        }
                    })
                resultDiv.innerHTML = html;

                // if(data.status){
                //     resultDiv.textContent = JSON.stringify(data,null,2); 
                // }    
            }else{
                resultDiv.innerHTML ='<span class="error">ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤</span>'
            }
        }
        </script>
    </body>
</html>